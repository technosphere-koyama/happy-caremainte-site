<?php
$publicGadget = new PublicGadget();
?>
<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<script type="text/javascript">
if ((navigator.userAgent.indexOf('iPhone') > 0) || navigator.userAgent.indexOf('iPod') > 0 || navigator.userAgent.indexOf('Android') > 0 || navigator.userAgent.indexOf('CareMenteh App User') != -1) {
	document.write('<meta name="viewport" content="width=320, user-scalable=no" />');
}else{
	document.write('<meta name="viewport" content="width=1280" />');
}
</script>
<title>フレンド一覧｜つなぐ ＜Happy SNS＞｜ハッピー ケアメンテ®</title>
<link href="/wp/wp-content/themes/HAPPY_Dark/css/common.css" rel="stylesheet">
<link href="/wp/wp-content/themes/HAPPY_Dark/css/mypage.css" rel="stylesheet">
<link href="../../css/form.css" rel="stylesheet">
<link href="/wp/wp-content/themes/HAPPY_Dark/css/sns_dummy.css" rel="stylesheet">
<link href="/wp/wp-content/themes/HAPPY_Dark/css/sns.css" rel="stylesheet">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
<!--[if lt IE 9]>
  <script src="/common/js/html5shiv.min.js"></script>
<![endif]-->
</head>
<body id="mypage" class="sns_top">
	<?php
  /* ヘッダーインクルード */
  include(DIR_PUBLIC . "/include/header_new.php");
  ?>
			<div id="Contents">

				<div class="mainvisual__section">
					<div>PROFILE<br><p>プロフィール</p></div>
				</div>
				<div class="logoutArea">
					<div class="logoutBtn"><a href="/mypage/logout/">ログアウト</a></div>
				</div>

				<div id="pankuzu-wrapp">
					<div class="pan-border"><p class="pankuzu"><a href="/">トップ</a></p><p class="pankuzu">プロフィール</p><p class="pankuzu no-arrow"><?php echo $this->get("nickname") ?>さん</p></div>
				</div>

				<div class="mypageNavi PCpart">
					<ul>
						<li><a href="/mypage/sns.html">トップ</a></li>
						<li><a href="/mypage/friend/">フレンド</a></li>
						<li><a href="/community/">コミュニティ</a></li>
						<li><a href="/mypage/message/">メッセージ</a><?php if ($this->get("count_unread") > 0) { ?><div class="unreadMsgNumber"><span><?php echo $this->get("count_unread"); ?></span></div><?php } ?></li>
						<li class="current"><a href="<?php echo $this->get("user_link"); ?>">プロフィール</a></li>
					</ul>
				</div>

				<div class="mypageHead SPpart">
					<ul>
					  <li><a href="/mypage/sns.html"><span>トップ</span></a></li>
					  <li><a href="/mypage/friend/"><span>フレンド</span></a></li>
					  <li><a href="/community/"><span>コミュニティ</span></a></li>
					  <li><a href="/mypage/message/"><span>メッセージ</span></a></li>
					  <li class="current"><a href="<?php echo $this->get("user_link"); ?>"><span>プロフィール</span></a></li>
					</ul>
				</div>

				<div class="mypageArea">
					<?php if (!StaticFunction::is_empty($this->get('error'))) { ?>
						<div id="mypagetab" class="mypageMain">
							<p class="error_box">
								<?php echo $this->get('error'); ?>
							</p>
						</div>
					<?php } else { ?>

						<div class="mypageMain">

							<div class="mainSide">
								<div class="userProfile2">
									<div class="userAvatar"><img src="<?php echo $this->get("avatar"); ?>?<?php echo date('YmdHis');?>" alt="<?php echo $this->get("nickname") ?>"></div>
									<?php if ($this->get("is_self")) { ?>
				                    <div class="userProfile2">
				                        <form name="form_thumb" method="POST" action="../mypage/avatar.html"  enctype="multipart/form-data">
				                            <input type="hidden" name="token" value="<?php echo SESSION::read('EXPIRES.ORIGINAL_TOKEN'); ?>">
				                            <input class="btn-hidden" type="file" name="avatar" value="">
				                            <div class="userAvatarBtn btn-open"><a href="javascript:void(0)" onclick="">写真を変更</a></div>
				                            <div class="userAvatarBtn btn-hidden"><a href="javascript:void(0)" onclick="document.form_thumb.submit()">変更する</a></div>
				                        </form>
				                    </div>
				                    <?php } ?>
									<?php if (!$this->get("is_self") && !$this->get("is_master")) { ?>
										<?php if ($this->get("is_match")) { ?>
											<div class="userAvatarBtn"><a href="/profile/?uid=<?php echo $this->get("system_id") ?>&mode=remove&token=<?php echo SESSION::read('EXPIRES.ORIGINAL_TOKEN'); ?>">フレンド解除</a></div>
										<?php } else { ?>
											<div class="userAvatarBtn"><a href="/profile/?uid=<?php echo $this->get("system_id") ?>&mode=set&token=<?php echo SESSION::read('EXPIRES.ORIGINAL_TOKEN'); ?>">フレンド申請</a></div>
										<?php } ?>
									<?php } ?>
								</div>

								<div class="userCommunity">
									<h5>コミュニティ</h5>
									<?php foreach ($this->get("communityArray") AS $community) { ?>

										<div class="userCommunityInfo">
											<div class="userCommunityImg"><a href="<?php echo $community['thread_link'] ?>"><img src="<?php echo $community['avatar'] ?>" alt="<?php echo $community['community_name'] ?>"></a></div>
											<div class="userCommunityName"><a href="<?php echo $community['thread_link'] ?>"><?php echo $community['community_name'] ?></a></div>
										</div>
									<?php } ?>

									<div class="userCommunityBtn1"><a href="/profile/community/?uid=<?php echo $this->get("system_id") ?>">参加コミュニティ一覧</a></div>
									<div class="userCommunityBtn2"><a href="/community/">コミュニティを探す</a></div>
								</div>


								<div class="userFriends">
									<h5>フレンド</h5>
									<?php foreach ($this->get("friendArray") AS $friends) { ?>
										<div class="userFriendsInfo">
											<div class="userFriendsImg"><a href="/profile/?uid=<?php echo $friends['system_id']; ?>"><img src="<?php echo $friends['avatar']; ?>" alt="<?php echo $friends['nickname']; ?>"></a></div>
											<div class="userFriendsName"><a href="/profile/?uid=<?php echo $friends['system_id']; ?>"><?php echo $friends['nickname']; ?></a></div>
										</div>
									<?php } ?>
									<div class="userFriendsBtn"><a href="/profile/friend/?uid=<?php echo $this->get("system_id") ?>">フレンド一覧</a></div>
								</div>

							</div><!--/mainSide-->

							<div class="mainContents">
								<div class="profileAre">
									<dl>
										<dt>ニックネーム</dt>
										<dd><?php echo $this->get("nickname"); ?></dd>
										<?php if (!StaticFunction::is_empty($this->get("name"))) { ?>
											<dt>お名前</dt>
											<dd><?php echo $this->get("name"); ?></dd>
										<?php } ?>
										<dt>性別</dt>
										<dd><?php echo $this->get("sex"); ?></dd>
										<dt>誕生日</dt>
										<dd><?php echo $this->get("birth"); ?></dd>
										<dt>ファッション系統</dt>
										<dd><?php echo $this->get("fashion_view"); ?></dd>
										<dt>好きなブランド</dt>
										<dd><?php echo $this->get("like_brand"); ?></dd>
										<dt class="selfIntro">自己紹介</dt>
										<dd class="selfIntro"><?php echo nl2br($this->get("comment")); ?></dd>
									</dl>
									<?php if ($this->get("is_self")) { ?>
										<div class="profileBtn"><a href="/mypage/edit/">プロフィールを変更</a></div>
									<?php } ?>
								</div>

								<?php if (!$this->get("is_self") && $this->get("is_match")) { ?>
									<form id="form_1" name="form01" method="POST" action="<?php echo FILENAME ?>?uid=<?php echo REQUEST::get_data("uid") ?>"  enctype="multipart/form-data">
										<input type="hidden" name="uid" value="<?php echo $this->get("system_id") ?>">
										<?php $publicGadget->html_error_array($this->get('error_array')); ?>
                                        <h5 class="messageSend">このフレンドにメッセージを送る</h5>
										<div class="postingForm send">
											<textarea name="message" placeholder="メッセージを入力"><?php echo $this->get("message") ?></textarea>
											<div class="postingBottom">
												<div class="postingImgBtn"><span class="SPpart">ファイルを選択</span><input type="file" name="message_file" accept="video/*,  video/x-m4v, video/webm, video/x-ms-wmv, video/x-msvideo, video/3gpp, video/flv, video/mp4, video/quicktime, video/mpeg, video/ogv, image/*" display="inline" role="button" tabindex="0"></div>
												<div class="postingBtnArea"><button type="submit" value=""><span>メッセージを送信する</span></button></div>
											</div>
										</div><!--/postingForm-->
									</form>
								<?php } ?>

                                <!-- postingarea loop -->
                                <?php $thread_ids = $this->get("community_match"); ?>
								<?php foreach ($this->get("timeline_array") AS $tlValue) { ?>
									<div class="postingArea">
										<div class="userAvatar"><img src="<?php echo $tlValue['avatar'] ?>" alt="<?php echo $tlValue['nickname'] ?>"></div>
										<div class="userTxt">
											<div class="userName"><a href="/profile/?uid=<?php echo $tlValue['system_id'] ?>"><?php echo $tlValue['nickname'] ?></a></div>
											<div class="postingTime"><?php echo $tlValue['update_time'] ?></div>
                                            <?php if (!StaticFunction::is_empty($tlValue['thread_id'])) { ?>
                                                <div class="userName2">コミュニティ名：<a href="/community/detail.html?tid=<?php echo $tlValue['thread_id'] ?>"><?php echo $tlValue['thread_name'] ?></a></div>
                                            <?php } ?>

                                        </div>
										<div class="postingTxt"><?php echo $tlValue['text_view']; ?></div>
                                        <?php /* タイムラインの画像一覧 */
                                        if (!StaticFunction::is_empty($tlValue['file_url'])) {
                                            foreach($tlValue['file_url'] AS $img_url) {
                                                ?>
                                                <div class="postingImg"><a href="<?php echo $img_url; ?>" data-lightbox="image-<?php echo $tlValue['prefix'] ?>_<?php echo $tlValue['mypage_id'] ?>"><img src="<?php echo $img_url; ?>"></a><?php if ($tlValue['is_my_post']) { // 自分のタイムライン ?><br><a href="./delete_timeline_image.html?tid=<?php echo $tlValue['mypage_id'] ?>&file_name=<?php echo $img_url ?>&pd=<?php echo $this->get("pd") ?>&pp=<?php echo $this->get("pp") ?>" class="edit-delete">削除</a><?php } ?></div>
                                                <?php
                                            }
                                        }
                                        ?>
										<div class="postingLike"><a href="javascript:void(0)" rel="<?php echo $tlValue['prefix'] ?>:<?php echo $tlValue['mypage_id'] ?>" role="button"><img src="/_assets/img/mypage/like.png">:<span class="like_count"><?php echo $tlValue['like_count'] ?></span></a></div>

										<!-- タイムラインへの返信ここから -->
										<?php if (!StaticFunction::is_empty($this->get("timeline_response_array." . $tlValue['mypage_id'])) && $tlValue['prefix'] === "timeline") { ?>
											<?php foreach ($this->get("timeline_response_array." . $tlValue['mypage_id']) AS $response) { ?>
                                            	<div class="postingComment noBorder noform">
                                                    <div class="postingCommentArea replay">
                                                        <div class="userAvatar">
                                                            <a href="<?php echo $response['user_link'] ?>"><img src="<?php echo $response['avatar'] ?>" alt="<?php echo $response['nickname'] ?>"></a>
                                                        </div>
                                                        <div class="userTxt">
                                                            <div class="userName">
                                                                <a href="<?php echo $response['user_link'] ?>"><?php echo $response['nickname'] ?></a>
                                                                <p><?php echo $response['response_text'] ?></p>
                                                            </div>
                                                            <div class="postingTime"><?php echo $response['update_time'] ?></div>
                                                            <?php if (!StaticFunction::is_empty($response['edit_link'])) { // 自分のコメントの削除 ?>
                                                                <a href="javascript:void(0)" class="response_del">削除</a>
                                                                <a href="<?php echo $response['edit_link'] ?>" class="response_del_commit" style="display:none;">削除する</a>
                                                            <?php } ?>
                                                        </div>
                                                    </div>
                                                </div>
											<?php } ?>
										<?php } ?>
										<!-- タイムラインへの返信ここまで -->


                                        <!-- コミュニティへの返信ここから -->
                                        <?php if ($tlValue['prefix'] == 'response') { ?>
                                            <?php if(!StaticFunction::is_empty($this->get("comment_array.".$tlValue['mypage_id']))) { ?>
                                                <?php foreach ($this->get("comment_array.".$tlValue['mypage_id']) AS $response) { ?>
                                                    <div class="postingComment noBorder">
                                                        <div class="postingCommentArea replay">
                                                            <div class="userAvatar">
                                                                <a href="<?php echo $response['user_link'] ?>"><img src="<?php echo $response['avatar'] ?>" alt="<?php echo $response['nickname'] ?>"></a>
                                                            </div>
                                                            <div class="userTxt">
                                                                <div class="userName">
                                                                    <a href="<?php echo $response['user_link'] ?>"><?php echo $response['nickname'] ?></a>
                                                                    <p><?php echo $response['comment_text'] ?></p>
                                                                </div>
                                                                <div class="postingTime"><?php echo $response['update_time'] ?></div>
                                                                <?php if (!StaticFunction::is_empty($response['edit_link'])) { // 自分のコメントの削除 ?>
                                                                    <a href="javascript:void(0)" class="response_del">削除</a>
                                                                    <a href="<?php echo $response['edit_link'] ?>" class="response_del_commit" style="display:none;">削除する</a>
                                                                <?php } ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                <?php }} ?>
                                            <?php if (in_array($tlValue['thread_id'],$thread_ids)) { ?>
                                                <div class="postingComment noBorder">
                                                    <div class="postingReplay last">
                                                        <form id="form_2" name="form01" method="POST" action="/community/comment.html"  enctype="multipart/form-data">
                                                            <input type="hidden" name="token" value="<?php echo SESSION::read('EXPIRES.ORIGINAL_TOKEN'); ?>">
                                                            <input type="hidden" name="thread_id" value="<?php echo $tlValue['thread_id'] ?>">
                                                            <input type="hidden" name="response_id" value="<?php echo $tlValue['mypage_id'] ?>">
                                                            <div class="userAvatar PCpart"><img src="<?php echo $this->get("my_avatar"); ?>" alt="<?php echo $this->get("nickname"); ?>"></div>
                                                            <textarea name="comment_text" placeholder="コメントを入力" class="sns" id="adjust"></textarea>
                                                            <button type="submit" value="" class="response_submit"><span>コメントする</span></button>
                                                        </form>
                                                    </div>
                                                </div>
                                            <?php } else { ?>
                                                <div class="postingComment noBorder">
                                                    <a href="/community/detail.html/?tid=<?php echo $tlValue['thread_id'] ?>&mode=entry" class="btn_entry_community">コミュニティに参加する</a></a>
                                                </div>
                                            <?php } ?>
                                        <?php } ?>
                                        <!-- コミュニティへの返信ここまで -->

									</div>
								<?php } ?>

								<div class="postingPagenavi">
									<ul class="pageNumbers">
										<?php echo $this->get("pageng_html"); ?>
									</ul>
								</div>
							</div><!--/mainContents-->
						</div>

						<div class="mypageSub">
							<?php $publicGadget->get_news(); /* 右カラムのお知らせ */ ?>
						</div><!--/mypageSub-->
					<?php } ?>
				</div>
			</div><!--/Contents-->
			<div class="footer_sns">
				<div class="container">
				  <ul>
					<li><a href="https://www.facebook.com/pages/%e3%83%8f%e3%83%83%e3%83%94%e3%83%bc%2d%e3%82%b1%e3%82%a2%e3%83%a1%e3%83%b3%e3%83%86Happy%2dCareMenteh%2f107312759374049" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
					<li><a href="https://twitter.com/Happy_KYOTO" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
					<li><a href="https://www.instagram.com/happycarementeh/" target="_blank"><i class="fa fa-instagram" aria-hidden="true"></i></a></li>
					<li><a href="https://www.youtube.com/channel/UCZyJC69VvnDqIAgsEQ-rTeQ" target="_blank"><i class="fa fa-youtube" aria-hidden="true"></i></a></li>
				  </ul>
				</div>
			  </div>
			<!--　/.footer_sns -->
	<?php
	/* ヘッダーインクルード */
	include(DIR_PUBLIC . "/include/footer_new.php");
	?>
		<script type="text/javascript">
			$(document).ready(function () {
				$('[id^=def-]').darkTooltip({
					trigger: 'click',
					opacity: 1,
					gravity: 'north'
				});
			});
		</script>
		<script>
			$('.menu_button').click(function () {
				$(this).next('.nav').slideToggle('slow').siblings('.nav').slideUp('slow');
				$(this).siblings('.menu_button').removeClass('active');
				$(this).toggleClass('active');
			});
		</script>
		<script>
			$(function () {

				$('a[href^="#"]').click(function(){
				var speed = 500;
				var href= $(this).attr("href");
				var target = $(href == "#" || href == "" ? 'html' : href);
				var position = target.offset().top;
				$("html, body").animate({scrollTop:position}, speed, "swing");
				return false;
				});
					
				var menuFlag = true;
				$('.header_nav_common .header_tab').on('click', function() {
				menuFlag = !menuFlag;
				if(menuFlag){
					$('.header_nav_common').css("top","0");
				} else {
					$('.header_nav_common').css("top","-95px");
				}
				});

				$(".edit-form").css("clear", "both").hide();
				$(".edit-timeline").on("click", function () {
					var targ = $(this).attr("rel");
					$(".target_" + targ).find(".postingTxt").hide();
					$(".target_" + targ).find(".edit-form").show();
				});
				$(".response_del").on("click", function () {
					$(this).hide();
					$(this).next(".response_del_commit").show();
				});
				$(".btn-hidden").hide();
			    $(".btn-open").on("click", function () {
			      $(this).hide();
			      $(".btn-hidden").show();
			    });
			    $(".edit-form").css("clear", "both").hide();
			    $(".edit-timeline").on("click", function () {
			      var targ = $(this).attr("rel");
			      $(".target_" + targ).find(".postingTxt").hide();
			      $(".target_" + targ).find(".edit-form").show();
			    });
			    $(".response_del").on("click", function () {
			      $(this).hide();
			      $(this).next(".response_del_commit").show();
			    });
			});
		</script>


	</body>
</html>
